<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Fixed sizing for App-like feel on phones -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sign In | It's Pure Veda</title>
    
    <!-- Icons & Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           1. CORE VARIABLES & RESET
           ========================================= */
        :root {
            --primary: #166534;       /* Deep Green */
            --primary-dark: #052e16;
            --accent: #d97706;        /* Gold/Orange */
            --bg-light: #f3f4f6;
            --white: #ffffff;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --danger: #ef4444;
            --sidebar-width: 260px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }

        body { background: var(--bg-light); height: 100vh; overflow: hidden; display: flex; color: var(--text-dark); }

        /* =========================================
           2. DISGUISED LOGIN SCREEN
           ========================================= */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #f0fdf4, #dcfce7); /* Soft Green Gradient */
            z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 40px 30px;
            border-radius: 24px;
            text-align: center;
            width: 85%; max-width: 320px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.6);
            animation: floatUp 0.6s ease-out;
        }
        @keyframes floatUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Generic User Icon to hide Admin nature */
        .login-icon { 
            width: 60px; height: 60px; background: var(--bg-light); border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; 
            color: var(--primary); font-size: 1.5rem; 
        }

        .login-card h2 { font-size: 1.5rem; margin-bottom: 5px; color: var(--text-dark); }
        .login-card p { font-size: 0.9rem; color: var(--text-light); margin-bottom: 25px; }

        .input-group { position: relative; margin-bottom: 15px; }
        .input-group i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #9ca3af; font-size: 0.9rem; }
        
        .login-input { 
            width: 100%; padding: 14px 14px 14px 45px; 
            border: 1px solid #e5e7eb; border-radius: 12px; 
            font-size: 0.95rem; background: white; transition: 0.3s;
        }
        .login-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(22, 101, 52, 0.1); }

        .btn-login { 
            width: 100%; padding: 14px; margin-top: 10px;
            background: var(--primary); color: white; border: none; 
            border-radius: 12px; font-weight: 600; font-size: 1rem; 
            cursor: pointer; transition: 0.3s; box-shadow: 0 4px 12px rgba(22, 101, 52, 0.2); 
        }
        .btn-login:hover { background: var(--primary-dark); transform: translateY(-2px); }
        
        #login-error { color: var(--danger); margin-top: 15px; font-size: 0.85rem; display: none; background: #fee2e2; padding: 8px; border-radius: 8px; }

        /* =========================================
           3. SIDEBAR NAVIGATION
           ========================================= */
        aside {
            width: var(--sidebar-width); background: var(--primary-dark); color: white;
            display: flex; flex-direction: column; padding: 25px 15px;
            height: 100vh; flex-shrink: 0; z-index: 1001; 
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
        }

        .brand-box { 
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 30px; padding: 0 10px;
        }
        .brand-logo { font-size: 1.4rem; font-weight: 700; color: white; display: flex; align-items: center; gap: 10px; }
        .brand-logo i { color: #4ade80; }
        
        .menu-category { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; color: rgba(255,255,255,0.4); margin: 20px 10px 10px; font-weight: 700; }

        .nav-item {
            padding: 12px 15px; margin-bottom: 4px; border-radius: 10px; cursor: pointer;
            display: flex; align-items: center; gap: 12px; color: rgba(255,255,255,0.7); 
            font-size: 0.9rem; font-weight: 500; transition: 0.2s;
        }
        .nav-item:hover { background: rgba(255,255,255,0.1); color: white; }
        .nav-item.active { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.2); font-weight: 600; }
        .nav-item i { width: 20px; text-align: center; }

        .logout-btn { margin-top: auto; color: #fca5a5; background: rgba(239,68,68,0.1); }
        .logout-btn:hover { background: var(--danger); color: white; }

        /* Mobile Hamburger */
        .mobile-header {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 60px;
            background: white; z-index: 900; align-items: center; justify-content: space-between;
            padding: 0 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .hamburger { font-size: 1.4rem; color: var(--text-dark); cursor: pointer; padding: 5px; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: none; opacity: 0; transition: opacity 0.3s; }

        /* =========================================
           4. MAIN DASHBOARD CONTENT
           ========================================= */
        main { flex: 1; padding: 30px; overflow-y: auto; position: relative; padding-top: 30px; }
        
        .header-flex { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
        .page-title { font-size: 1.8rem; font-weight: 800; color: var(--text-dark); }
        
        .section-view { display: none; animation: fadeIn 0.4s ease; }
        .section-view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Cards & Tables */
        .content-card { background: white; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: 1px solid #f3f4f6; overflow: hidden; margin-bottom: 20px; }
        .card-body { padding: 25px; }
        
        /* Form Elements */
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; color: var(--text-dark); }
        .form-control { width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 0.95rem; transition: 0.3s; }
        .form-control:focus { border-color: var(--primary); }
        textarea.form-control { resize: vertical; min-height: 100px; }
        
        .btn-action { 
            padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; 
            display: inline-flex; align-items: center; gap: 8px; transition: 0.2s; font-size: 0.9rem;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-dark { background: var(--text-dark); color: white; }
        
        /* Responsive Tables */
        .table-responsive { overflow-x: auto; width: 100%; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { background: #f9fafb; text-align: left; padding: 15px; font-size: 0.85rem; font-weight: 600; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.5px; }
        td { padding: 15px; border-bottom: 1px solid #f3f4f6; font-size: 0.95rem; color: var(--text-dark); vertical-align: middle; }
        td img { width: 45px; height: 45px; border-radius: 8px; object-fit: cover; border: 1px solid #eee; }
        
        .icon-btn { width: 32px; height: 32px; border-radius: 6px; border: none; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; margin-right: 5px; color: white; transition: 0.2s; }
        .btn-edit { background: var(--accent); }
        .btn-del { background: var(--danger); }
        .btn-view { background: #3b82f6; }

        /* =========================================
           5. MODALS & UPLOAD
           ========================================= */
        .modal-backdrop { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.6); z-index: 5000; display: none; 
            justify-content: center; align-items: center; backdrop-filter: blur(4px);
        }
        .modal-box { 
            background: white; width: 550px; max-width: 90%; max-height: 90vh; 
            border-radius: 16px; box-shadow: 0 25px 50px rgba(0,0,0,0.2); 
            display: flex; flex-direction: column; overflow: hidden;
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .modal-header { padding: 20px; border-bottom: 1px solid #f3f4f6; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .modal-body { padding: 20px; overflow-y: auto; }
        .modal-footer { padding: 15px 20px; border-top: 1px solid #f3f4f6; background: #f9fafb; text-align: right; }
        .close-modal { font-size: 1.5rem; cursor: pointer; color: #9ca3af; }

        /* Image Upload */
        .upload-area { 
            border: 2px dashed #d1d5db; padding: 25px; text-align: center; border-radius: 12px; 
            cursor: pointer; background: #f9fafb; transition: 0.3s; position: relative;
        }
        .upload-area:hover { border-color: var(--primary); background: #f0fdf4; }
        .img-preview-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .img-thumb { position: relative; aspect-ratio: 1; border-radius: 8px; overflow: hidden; border: 1px solid #eee; }
        .img-thumb img { width: 100%; height: 100%; object-fit: cover; }
        .remove-img { position: absolute; top: 4px; right: 4px; background: rgba(0,0,0,0.7); color: white; width: 20px; height: 20px; border-radius: 50%; cursor: pointer; font-size: 10px; display: flex; align-items: center; justify-content: center; }

        /* =========================================
           6. RESPONSIVE MOBILE STYLES
           ========================================= */
        @media (max-width: 900px) {
            body { flex-direction: column; }
            .mobile-header { display: flex; }
            
            aside {
                position: fixed; left: -100%; top: 0; height: 100%; width: 280px;
                box-shadow: 5px 0 30px rgba(0,0,0,0.2); transition: 0.3s ease;
            }
            aside.active { left: 0; }
            .overlay.active { display: block; opacity: 1; }

            main { padding: 80px 15px 30px; width: 100%; }
            .header-flex { flex-direction: column; align-items: flex-start; gap: 10px; }
            .btn-action { width: 100%; justify-content: center; }

            .modal-box { width: 100%; height: 100%; max-height: 100%; border-radius: 0; }
            .modal-footer { position: sticky; bottom: 0; }
        }
    </style>
</head>
<body>

    <!-- 1. DISGUISED LOGIN SCREEN -->
    <div id="login-screen">
        <div class="login-card">
            <div class="login-icon"><i class="fas fa-user"></i></div>
            <h2>Welcome Back</h2>
            <p>Please enter your details to sign in.</p>
            
            <div class="input-group">
                <i class="fas fa-envelope"></i>
                <input type="text" id="username-input" class="login-input" placeholder="Username">
            </div>
            <div class="input-group">
                <i class="fas fa-lock"></i>
                <input type="password" id="password-input" class="login-input" placeholder="Password">
            </div>
            
            <button onclick="checkLogin()" class="btn-login">Sign In</button>
            <div id="login-error"><i class="fas fa-exclamation-circle"></i> Invalid Credentials</div>
        </div>
    </div>

    <!-- 2. MOBILE HEADER & OVERLAY -->
    <div class="mobile-header">
        <div style="font-weight:700; font-size:1.2rem; color:var(--primary);"><i class="fas fa-leaf"></i> Pure Veda</div>
        <div class="hamburger" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
    </div>
    <div class="overlay" onclick="toggleSidebar()"></div>

    <!-- 3. SIDEBAR NAVIGATION -->
    <aside id="sidebar">
        <div class="brand-box">
            <div class="brand-logo"><i class="fas fa-leaf"></i> Admin Panel</div>
            <i class="fas fa-times" style="cursor:pointer; display:none;" onclick="toggleSidebar()"></i> 
        </div>

        <div class="menu-category">Dashboard</div>
        <div class="nav-item active" onclick="switchTab('settings')"><i class="fas fa-sliders-h"></i> Settings</div>
        <div class="nav-item" onclick="switchTab('orders')"><i class="fas fa-shopping-basket"></i> <b>Gift Claims</b></div>

        <div class="menu-category">Store Content</div>
        <div class="nav-item" onclick="switchTab('hero')"><i class="fas fa-images"></i> Home Banners</div>
        <div class="nav-item" onclick="switchTab('trending')"><i class="fas fa-fire"></i> Trending</div>
        <div class="nav-item" onclick="switchTab('live')"><i class="fas fa-broadcast-tower"></i> Live Shop</div>
        <div class="nav-item" onclick="switchTab('rewards')"><i class="fas fa-gift"></i> Rewards</div>
        <div class="nav-item" onclick="switchTab('upcoming')"><i class="fas fa-clock"></i> Upcoming</div>

        <button class="nav-item logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sign Out</button>
    </aside>

    <!-- 4. MAIN CONTENT AREA -->
    <main>
        <!-- A. SETTINGS -->
        <div id="settings-section" class="section-view active">
            <div class="header-flex">
                <h1 class="page-title">Global Settings</h1>
                <button class="btn-action" style="background:#6b7280; color:white;" onclick="factoryReset()"><i class="fas fa-undo"></i> Reset App Data</button>
            </div>
            <div class="content-card">
                <div class="card-body">
                    <div style="margin-bottom:15px;">
                        <label class="form-label">Phone Number (For WhatsApp/Calls)</label>
                        <input type="text" id="set-phone" class="form-control" placeholder="e.g. 9561234466">
                    </div>
                    <div style="margin-bottom:15px;">
                        <label class="form-label">Currency Symbol</label>
                        <input type="text" id="set-currency" class="form-control" placeholder="e.g. $ or â‚¹">
                    </div>
                    <button class="btn-action btn-primary" onclick="saveSettings()">Save Changes</button>
                </div>
            </div>
        </div>

        <!-- B. ORDERS -->
        <div id="orders-section" class="section-view">
            <div class="header-flex">
                <h1 class="page-title">Gift Claims</h1>
                <button class="btn-action btn-primary" onclick="refreshOrders()"><i class="fas fa-sync-alt"></i> Refresh List</button>
            </div>
            <div class="content-card">
                <div class="table-responsive">
                    <table>
                        <thead><tr><th>Date</th><th>Customer</th><th>Gift</th><th>Status</th><th>Actions</th></tr></thead>
                        <tbody id="orders-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- C. CONTENT SECTIONS (Hero, Trending, etc) -->
        <!-- All share similar structure, rendered dynamically -->
        <div id="hero-section" class="section-view">
            <div class="header-flex"><h1 class="page-title">Home Banners</h1><button class="btn-action btn-dark" onclick="openEditor('hero')">+ Add Image</button></div>
            <div class="content-card"><div class="table-responsive"><table><thead><tr><th>Preview</th><th>Status</th><th>Actions</th></tr></thead><tbody id="hero-table-body"></tbody></table></div></div>
        </div>

        <div id="trending-section" class="section-view">
            <div class="header-flex"><h1 class="page-title">Trending Products</h1><button class="btn-action btn-dark" onclick="openEditor('trending')">+ Add Product</button></div>
            <div class="content-card"><div class="table-responsive"><table><thead><tr><th>Image</th><th>Name</th><th>Price</th><th>Actions</th></tr></thead><tbody id="trending-table-body"></tbody></table></div></div>
        </div>

        <div id="live-section" class="section-view">
            <div class="header-flex"><h1 class="page-title">Live Shop</h1><button class="btn-action btn-dark" onclick="openEditor('live')">+ Add Product</button></div>
            <div class="content-card"><div class="table-responsive"><table><thead><tr><th>Image</th><th>Name</th><th>Category</th><th>Price</th><th>Actions</th></tr></thead><tbody id="live-table-body"></tbody></table></div></div>
        </div>
        
        <div id="rewards-section" class="section-view">
            <div class="header-flex"><h1 class="page-title">Rewards Config</h1><button class="btn-action btn-dark" onclick="openEditor('rewards')">+ Add Gift</button></div>
            <div class="content-card"><div class="table-responsive"><table><thead><tr><th>Image</th><th>Gift Name</th><th>Description</th><th>Actions</th></tr></thead><tbody id="rewards-table-body"></tbody></table></div></div>
        </div>

        <div id="upcoming-section" class="section-view">
            <div class="header-flex"><h1 class="page-title">Upcoming Items</h1><button class="btn-action btn-dark" onclick="openEditor('upcoming')">+ Add Item</button></div>
            <div class="content-card"><div class="table-responsive"><table><thead><tr><th>Image</th><th>Name</th><th>Launch Date</th><th>Actions</th></tr></thead><tbody id="upcoming-table-body"></tbody></table></div></div>
        </div>
    </main>

    <!-- 5. EDITOR MODAL -->
    <div id="editor-modal" class="modal-backdrop">
        <div class="modal-box">
            <div class="modal-header">
                <h3 id="editor-title" style="font-weight:700; color:var(--text-dark);">Edit Item</h3>
                <span class="close-modal" onclick="closeEditor()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editor-form" onsubmit="return false;">
                    <input type="hidden" id="edit-id">
                    
                    <!-- Title -->
                    <div style="margin-bottom:15px;" id="grp-title">
                        <label class="form-label">Title / Name</label>
                        <input type="text" id="edit-title" class="form-control" required>
                    </div>

                    <!-- Images -->
                    <div style="margin-bottom:15px;">
                        <label class="form-label">Images <span id="limit-msg" style="font-weight:400; color:#6b7280; font-size:0.8rem;">(Max 3)</span></label>
                        <div class="upload-area">
                            <label for="hidden-file-input" style="cursor:pointer; display:block;">
                                <i class="fas fa-cloud-upload-alt" style="font-size:2rem; color:#9ca3af; margin-bottom:5px;"></i>
                                <div style="color:var(--text-light); font-size:0.9rem;">Tap to upload images</div>
                            </label>
                            <input type="file" id="hidden-file-input" style="display:none;" accept="image/*" multiple onchange="handleFiles(this.files)">
                        </div>
                        <div id="loading-msg" style="display:none; color:var(--primary); font-weight:600; text-align:center; margin-top:5px;">Processing Image...</div>
                        <div class="img-preview-grid" id="image-previews"></div>
                    </div>

                    <!-- Dynamic Fields -->
                    <div style="margin-bottom:15px; display:none;" id="grp-price">
                        <label class="form-label">Price</label>
                        <input type="text" id="edit-price" class="form-control">
                    </div>
                    <div style="margin-bottom:15px; display:none;" id="grp-date">
                        <label class="form-label">Launch Date</label>
                        <input type="text" id="edit-date" class="form-control">
                    </div>
                    <div style="margin-bottom:15px; display:none;" id="grp-cat">
                        <label class="form-label">Category</label>
                        <input type="text" id="edit-cat" class="form-control">
                    </div>
                    <div style="margin-bottom:15px; display:none;" id="grp-theme">
                        <label class="form-label">Color Theme</label>
                        <select id="edit-theme" class="form-control">
                            <option value="theme-forest">Forest Green</option>
                            <option value="theme-saffron">Saffron Orange</option>
                            <option value="theme-ocean">Ocean Blue</option>
                            <option value="theme-lavender">Lavender Purple</option>
                            <option value="theme-charcoal">Charcoal Dark</option>
                        </select>
                    </div>
                    <div style="margin-bottom:15px; display:none;" id="grp-badge">
                        <label class="form-label">Badge Label</label>
                        <input type="text" id="edit-badge" class="form-control" placeholder="e.g. New, Hot">
                    </div>
                    <div style="margin-bottom:15px; display:none;" id="grp-desc">
                        <label class="form-label">Description</label>
                        <textarea id="edit-desc" class="form-control"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-action btn-primary" style="width:100%; justify-content:center;" onclick="saveItem()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- 6. ORDER DETAIL MODAL -->
    <div id="order-modal" class="modal-backdrop">
        <div class="modal-box" style="height:auto; max-height:80vh;">
            <div class="modal-header">
                <h3>Claim Details</h3>
                <span class="close-modal" onclick="closeOrderModal()">&times;</span>
            </div>
            <div class="modal-body" id="order-details-content">
                <!-- Injected via JS -->
            </div>
            <div class="modal-footer">
                <button class="btn-action btn-dark" style="width:100%; justify-content:center;" onclick="closeOrderModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA & STATE ---
        const initialData = {
            settings: { phoneNumber: "9561234466", currencySymbol: "$" },
            trending: [{ id: 1, title: "Rosemary Roots", price: "22.00", desc: "Stimulates growth.", img: "https://images.unsplash.com/photo-1601055903647-87e16f818d0b?w=400&q=80", theme: "theme-forest", badge: "Best Seller" }],
            live: [], upcoming: [], heroImages: [], 
            rewards: [{ id: 901, title: "Milton Thermoware", desc: "Premium insulated.", img: "https://images.unsplash.com/photo-1584269614539-772922616f06?w=400&q=80" }]
        };
        let db = {}, currentType = '', currentIndex = null, tempImages = [];

        // --- AUTHENTICATION ---
        function checkLogin() {
            const user = document.getElementById('username-input').value;
            const pass = document.getElementById('password-input').value;
            const errorMsg = document.getElementById('login-error');

            // Hardcoded Credentials
            if(user === "admin" && pass === "admin123") {
                // Success: Fade out login screen, show admin panel
                const screen = document.getElementById('login-screen');
                screen.style.transition = "opacity 0.5s";
                screen.style.opacity = "0";
                setTimeout(() => {
                    screen.style.display = 'none';
                    loadData(); 
                    refreshOrders();
                }, 500);
            } else {
                // Failure: Shake animation logic or just show error
                errorMsg.style.display = 'block';
                document.querySelector('.login-card').animate([
                    { transform: 'translateX(0)' },
                    { transform: 'translateX(-10px)' },
                    { transform: 'translateX(10px)' },
                    { transform: 'translateX(0)' }
                ], { duration: 300 });
            }
        }
        function logout() { location.reload(); }

        // --- UI NAVIGATION ---
        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            const ov = document.querySelector('.overlay');
            sb.classList.toggle('active');
            ov.classList.toggle('active');
        }

        function switchTab(id) {
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            document.querySelectorAll('.section-view').forEach(s => s.classList.remove('active'));
            document.getElementById(id + '-section').classList.add('active');
            
            // Close sidebar on mobile after selection
            if(window.innerWidth <= 900) toggleSidebar();
            
            if(id === 'orders') refreshOrders();
        }

        // --- DATABASE OPERATIONS ---
        function loadData() {
            const stored = localStorage.getItem('pureVedaData');
            if(stored) { 
                db = JSON.parse(stored); 
                if(!db.heroImages) db.heroImages=[]; 
                if(!db.rewards) db.rewards=initialData.rewards; 
            } else { 
                db = JSON.parse(JSON.stringify(initialData)); 
                saveData(); 
            }
            renderAll();
        }
        function saveData() { localStorage.setItem('pureVedaData', JSON.stringify(db)); }
        function factoryReset() { if(confirm("This will delete all custom products and settings. Are you sure?")) { localStorage.removeItem('pureVedaData'); location.reload(); } }

        // --- RENDER FUNCTIONS ---
        function renderAll() {
            document.getElementById('set-phone').value = db.settings.phoneNumber;
            document.getElementById('set-currency').value = db.settings.currencySymbol;
            
            renderTable('trending', db.trending); 
            renderTable('live', db.live);
            renderTable('upcoming', db.upcoming); 
            renderTable('rewards', db.rewards);
            renderHeroTable();
        }

        function renderTable(type, data) {
            const tbody = document.getElementById(type + '-table-body'); tbody.innerHTML = '';
            if(!data) return;
            data.forEach((item, idx) => {
                let img = (item.images && item.images.length>0) ? item.images[0] : (item.img||'');
                // Use default placeholder if no image
                if(!img) img = "https://via.placeholder.com/50";
                
                let col3 = item.price ? db.settings.currencySymbol+item.price : (item.date||item.desc);
                
                tbody.innerHTML += `
                    <tr>
                        <td><img src="${img}"></td>
                        <td style="font-weight:600;">${item.title}</td>
                        <td style="color:#6b7280;">${col3?col3.substring(0,25)+'...':''}</td>
                        <td>
                            <button class="icon-btn btn-edit" onclick="openEditor('${type}',${idx})"><i class="fas fa-pen"></i></button>
                            <button class="icon-btn btn-del" onclick="deleteItem('${type}',${idx})"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>`;
            });
        }

        function renderHeroTable() {
            const b = document.getElementById('hero-table-body'); b.innerHTML = '';
            if(!db.heroImages) db.heroImages=[];
            db.heroImages.forEach((src,i) => {
                b.innerHTML += `<tr><td><img src="${src}" style="width:100px; height:auto;"></td><td><span style="color:green;font-weight:bold;">Active</span></td><td><button class="icon-btn btn-del" onclick="deleteHeroImage(${i})"><i class="fas fa-trash"></i></button></td></tr>`;
            });
        }

        // --- ORDERS LOGIC ---
        function refreshOrders() {
            const claims = JSON.parse(localStorage.getItem('pureVedaClaims') || '[]');
            const tbody = document.getElementById('orders-table-body'); tbody.innerHTML = '';
            
            if(claims.length === 0) { 
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:30px;color:#999;">No claims received yet.</td></tr>'; 
                return; 
            }
            
            claims.slice().reverse().forEach((c, i) => {
                const realIdx = claims.length - 1 - i;
                tbody.innerHTML += `
                    <tr>
                        <td style="font-size:0.85rem; color:#666;">${c.date}</td>
                        <td style="font-weight:600;">${c.name}</td>
                        <td style="color:var(--accent); font-weight:600;">${c.gift}</td>
                        <td><span style="background:#dbeafe; color:#1e40af; padding:4px 10px; border-radius:12px; font-size:0.7rem; font-weight:700;">NEW</span></td>
                        <td>
                            <button class="icon-btn btn-view" onclick="viewOrder(${realIdx})"><i class="fas fa-eye"></i></button>
                            <button class="icon-btn btn-del" onclick="deleteOrder(${realIdx})"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>`;
            });
        }

        function viewOrder(i) {
            const c = JSON.parse(localStorage.getItem('pureVedaClaims') || '[]')[i];
            const content = `
                <div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #f3f4f6;"><span>Name:</span> <b>${c.name}</b></div>
                <div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #f3f4f6;"><span>Phone:</span> <b><a href="tel:${c.phone}">${c.phone}</a></b></div>
                <div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #f3f4f6;"><span>Gift:</span> <b style="color:var(--accent)">${c.gift}</b></div>
                <div style="padding-top:10px;">
                    <span style="color:#666; font-size:0.9rem;">Shipping Address:</span><br>
                    <b>${c.address}<br>${c.city}, ${c.state} - ${c.zip}</b>
                </div>
            `;
            document.getElementById('order-details-content').innerHTML = content;
            document.getElementById('order-modal').style.display = 'flex';
        }
        function closeOrderModal() { document.getElementById('order-modal').style.display = 'none'; }
        
        function deleteOrder(i) {
            if(confirm("Are you sure you want to delete this claim?")) {
                const c = JSON.parse(localStorage.getItem('pureVedaClaims')||'[]');
                c.splice(i, 1); 
                localStorage.setItem('pureVedaClaims', JSON.stringify(c)); 
                refreshOrders();
            }
        }

        // --- EDITOR LOGIC ---
        function openEditor(type, index = null) {
            if(type==='hero' && index===null && db.heroImages.length>=5) { alert("Max 5 banners allowed."); return; }
            
            currentType = type; currentIndex = index;
            document.getElementById('editor-modal').style.display = 'flex';
            document.getElementById('editor-form').reset();
            tempImages = [];
            
            // Toggle Fields based on type
            const ids = ['grp-title','grp-price','grp-date','grp-cat','grp-theme','grp-badge','grp-desc'];
            ids.forEach(id => document.getElementById(id).style.display = 'none');
            
            if(type!=='hero') document.getElementById('grp-title').style.display = 'block';
            if(['trending','live'].includes(type)) document.getElementById('grp-price').style.display = 'block';
            if(type==='upcoming') document.getElementById('grp-date').style.display = 'block';
            if(type==='live') document.getElementById('grp-cat').style.display = 'block';
            if(type==='trending') document.getElementById('grp-theme').style.display = 'block';
            if(!['hero','rewards'].includes(type)) document.getElementById('grp-badge').style.display = 'block';
            if(type!=='hero') document.getElementById('grp-desc').style.display = 'block';
            
            document.getElementById('limit-msg').innerText = type==='hero' ? "(Max 1)" : "(Max 3)";
            document.getElementById('editor-title').innerText = index!==null ? "Edit Item" : "Add New Item";

            // Populate if editing
            if(index !== null && type !== 'hero') {
                const item = db[type][index];
                document.getElementById('edit-title').value = item.title;
                if(item.desc) document.getElementById('edit-desc').value = item.desc;
                if(item.price) document.getElementById('edit-price').value = item.price;
                if(item.date) document.getElementById('edit-date').value = item.date;
                if(item.category) document.getElementById('edit-cat').value = item.category;
                if(item.badge) document.getElementById('edit-badge').value = item.badge;
                if(item.images) tempImages = [...item.images]; else if(item.img) tempImages=[item.img];
            }
            renderImagePreviews();
        }

        function closeEditor() { document.getElementById('editor-modal').style.display = 'none'; }

        // --- IMAGE HANDLING ---
        function handleFiles(files) {
            const max = currentType === 'hero' ? 1 : 3;
            if (tempImages.length + files.length > max) { alert(`Maximum ${max} images allowed.`); return; }
            
            document.getElementById('loading-msg').style.display = 'block';
            let processed = 0;
            
            Array.from(files).forEach(file => {
                const reader = new FileReader(); 
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    // Compress Image Logic (Canvas)
                    const img = new Image(); 
                    img.src = e.target.result;
                    img.onload = () => {
                        const c = document.createElement('canvas');
                        // Resize to max 600px width
                        const scale = 600/img.width; 
                        c.width=600; c.height=img.height*scale;
                        c.getContext('2d').drawImage(img,0,0,c.width,c.height);
                        
                        tempImages.push(c.toDataURL('image/jpeg',0.7)); // Compress to 70% quality
                        
                        if(++processed === files.length) { 
                            document.getElementById('loading-msg').style.display='none'; 
                            renderImagePreviews(); 
                        }
                    }
                }
            });
        }

        function renderImagePreviews() {
            const c = document.getElementById('image-previews'); c.innerHTML='';
            tempImages.forEach((src,i) => {
                c.innerHTML += `<div class="img-thumb"><img src="${src}"><div class="remove-img" onclick="removeImage(${i})"><i class="fas fa-times"></i></div></div>`;
            });
        }
        function removeImage(i) { tempImages.splice(i, 1); renderImagePreviews(); }

        // --- SAVING DATA ---
        function saveItem() {
            if(tempImages.length===0 && currentType==='hero') { alert("Please upload an image."); return; }
            // If hero, direct save
            if(currentType==='hero') { 
                db.heroImages.push(tempImages[0]); 
                saveData(); closeEditor(); renderAll(); 
                return; 
            }
            
            const newItem = {
                id: currentIndex!==null ? db[currentType][currentIndex].id : Date.now(),
                title: document.getElementById('edit-title').value,
                desc: document.getElementById('edit-desc').value,
                badge: document.getElementById('edit-badge').value,
                images: tempImages, 
                img: tempImages[0] // Fallback for old renderer
            };

            if(currentType==='trending') { 
                newItem.price = document.getElementById('edit-price').value; 
                newItem.theme = document.getElementById('edit-theme').value; 
            }
            if(currentType==='live') { 
                newItem.price = document.getElementById('edit-price').value; 
                newItem.category = document.getElementById('edit-cat').value; 
            }
            if(currentType==='upcoming') newItem.date = document.getElementById('edit-date').value;

            // Push or Update
            if(currentIndex===null) db[currentType].push(newItem); 
            else db[currentType][currentIndex] = newItem;
            
            saveData(); 
            closeEditor(); 
            renderAll();
        }

        function saveSettings() {
            db.settings.phoneNumber = document.getElementById('set-phone').value;
            db.settings.currencySymbol = document.getElementById('set-currency').value;
            saveData();
            alert("Settings Saved!");
        }

        function deleteItem(t,i) { if(confirm("Delete this item permanently?")) { db[t].splice(i,1); saveData(); renderAll(); } }
        function deleteHeroImage(i) { if(confirm("Remove this banner?")) { db.heroImages.splice(i,1); saveData(); renderAll(); } }

    </script>
</body>
</html>
